<?xml version="1.0"?>
<!-- build file for CSChecker project -->
<project name="CSChecker" default="build" basedir=".">

<!-- 
 You need TermWare and docbook for building.
 IzPack, if you want build installation.
-->

 <!-- set here location of TermWare installed (see http://www.gradsoft.com.ua ) -->
 <property name="termware.home" location="c:/home/rssh/work/TermWare" />

 <!-- set here location of JavaCC [version 2.1] -->
 <property name="javacchome" location="c:/local/java/javacc2.1/bin/lib" />

 <!-- set here location of IzPack (see http://www.izforge.com) -->
 <property name="izpackhome" location="c:/Program Files/Izpack" />
                
 <!-- set here location of docbook xsl (see http://www.docbook.org) -->
 <property name="docbookxsl" location="c:/local/docbook/docbook-xsl-1.64.1/html/docbook.xsl" />

 <!-- set here location of docbook dtd (see http://www.docbook.org) -->
 <property name="docbookdtd" location="c:/local/docbook/xmlcatalog/docbookx.dtd" />

 <!-- set here location of ant (see ant.apache.org ) -->
 <property name="anthome" location="c:/local/java/ant" />

 <!-- set here location of JavaChecker (see www.gradsoft.ua ) -->
 <property name="jchhome" location="c:/JavaChecker" />




 <!-- external tasks -->
 
 <taskdef name="izpack" classpath="${izpackhome}/lib/compiler.jar"
         classname="com.izforge.izpack.ant.IzPackTask"/>

 <taskdef name="javachecker"  classname="ua.kiev.gradsoft.JavaChecker.ant.JavaCheckerTask">
     <classpath>
      <pathelement location="${jchhome}/jlib/JavaChecker.jar"/>
      <pathelement location="${jchhome}/jlib/TermWare.jar"/>
     </classpath>
 </taskdef>


 <!-- targets -->

 <target name="clean">
  <delete>
   <fileset dir="jsrc"   includes="**/*.class" />
  </delete>
 </target>

 <target name="build-parser">
  <javacc target="jsrc/ua/gradsoft/parsers/cs/csharp.jj"
          javacchome="${javacchome}"
  />
 </target>

 
 <target name="build-classes">
  <javac srcdir="jsrc" includes="**/*.java">
    <classpath>
      <pathelement location="jsrc"/>
      <pathelement location="${termware.home}/jlib/TermWare.jar"/>
      <pathelement location="${java.class.path}/"/>      
    </classpath>
  </javac>
  <jar basedir="jsrc" includes="**/*.class" 
       destfile="jlib/CSChecker.jar" 
       index="true">
  <include name="build"/>
  <manifest>
   <attribute name="Build-By" value="${user-name}"/>
   <attribute name="Main-Class" value="ua.gradsoft.cschecker.Main"/>
  </manifest>
  </jar>
 </target>


 <target name="build"  depends="build-parser,build-classes">
 </target>



 <target name="check">
   <javachecker jchhome="." input="jsrc" output="jchreport.txt" prefs="etc/jchprefs.xml" />
 </target>


 <target name="CSCheckerGuide">
  <xslt style="${docbookxsl}" in="docs/CSCheckerGuide.xml" out="docs/CSCheckerGuide.html" >
    <xmlcatalog>
        <dtd 
            publicId="-//OASIS//DTD DocBook XML V4.2//EN"
            location="${docbookdtd}" />
    </xmlcatalog>
  </xslt>
 </target>

 <target name="docs" depends="CSCheckerGuide">
 </target>

 <target name="cpTermWare" >
   <copy file="${termware.home}/jlib/TermWare.jar" 
         tofile="jlib/TermWare.jar"
         preservelastmodified="yes"
   />
 </target>


 <target name="binary_installation" depends="build,docs,cpTermWare">
  <izpack input="installer/binary_installation.xml"
          output="installer/JavaCheckerBinaryInstaller.jar"
          installerType="standard-kunststoff"
          basedir="installer"
          IzPackDir="${izpackhome}"
  />
 </target>

 <target name="source_installation" depends="build,docs,cpTermWare">
  <izpack input="installer/source_installation.xml"
          output="installer/JavaCheckerSourceInstaller.jar"
          installerType="standard-kunststoff"
          basedir="installer"
          IzPackDir="${izpackhome}"
  />
 </target>

 <target name="installation" depends="binary_installation,source_installation" />


 <target name="all" depends="build,clean,docs,installation"/>

</project>
